{% extends "base" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="card">
    <div class="card-header">
        <h2>🔍 Entity Details</h2>
    </div>
    <div class="card-body">
        <div style="margin-bottom: 1rem;">
            <a href="javascript:history.back()" class="btn">← Back</a>
        </div>

        <div
            class="entity-header {% if 'function' in entity.kind or 'method' in entity.kind %}entity-function{% elif 'class' in entity.kind or 'struct' in entity.kind or 'interface' in entity.kind or 'trait' in entity.kind %}entity-class{% elif 'enum' in entity.kind %}entity-enum{% elif 'module' in entity.kind or 'namespace' in entity.kind %}entity-module{% elif 'variable' in entity.kind or 'constant' in entity.kind or 'field' in entity.kind %}entity-variable{% elif 'macro' in entity.kind %}entity-macro{% else %}entity-other{% endif %}">
            <h3 style="margin: 0; color: white;">{{ entity.name }}</h3>
            <div style="margin-top: 0.5rem;">
                <span
                    class="badge badge-{% if 'function' in entity.kind or 'method' in entity.kind %}entity-function{% elif 'class' in entity.kind or 'struct' in entity.kind or 'interface' in entity.kind or 'trait' in entity.kind %}entity-class{% elif 'enum' in entity.kind %}entity-enum{% elif 'module' in entity.kind or 'namespace' in entity.kind %}entity-module{% elif 'variable' in entity.kind or 'constant' in entity.kind or 'field' in entity.kind %}entity-variable{% elif 'macro' in entity.kind %}entity-macro{% else %}entity-other{% endif %}"
                    style="background: rgba(255,255,255,0.2); color: white;">{{ entity.kind }}</span>
                <span
                    class="badge {% if entity.language|lower == 'rust' or entity.language|lower == 'rs' %}lang-rust{% elif entity.language|lower == 'python' or entity.language|lower == 'py' %}lang-python{% elif entity.language|lower == 'javascript' or entity.language|lower == 'js' %}lang-javascript{% elif entity.language|lower == 'typescript' or entity.language|lower == 'ts' %}lang-typescript{% elif entity.language|lower == 'go' %}lang-go{% elif entity.language|lower == 'java' %}lang-java{% elif entity.language|lower == 'cpp' or entity.language|lower == 'c++' %}lang-cpp{% elif entity.language|lower == 'c' %}lang-c{% elif entity.language|lower == 'csharp' or entity.language|lower == 'c#' %}lang-csharp{% elif entity.language|lower == 'swift' %}lang-swift{% elif entity.language|lower == 'kotlin' %}lang-kotlin{% elif entity.language|lower == 'scala' %}lang-scala{% elif entity.language|lower == 'ruby' %}lang-ruby{% elif entity.language|lower == 'php' %}lang-php{% elif entity.language|lower == 'html' %}lang-html{% elif entity.language|lower == 'css' %}lang-css{% else %}lang-other{% endif %}"
                    style="background: rgba(255,255,255,0.2); color: white;">{{ entity.language }}</span>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
            <div>
                <strong>Type:</strong> {{ entity.kind }}<br>
                <strong>Language:</strong> {{ entity.language }}<br>
                <strong>File:</strong> <a
                    href="https://github.com/{{ repo_name }}/{{ entity.file|replace(repo_name + '/', '') }}{% if entity.start_line %}#L{{ entity.start_line }}{% endif %}"
                    target="_blank" style="color: #0366d6; text-decoration: none;">{{ entity.file }}{% if
                    entity.start_line %}:{{ entity.start_line }}{% endif %}</a><br>
                {% if entity.start_line %}
                <strong>Lines:</strong> {{ entity.start_line }}
                {% if entity.end_line %}-{{ entity.end_line }}{% endif %}
                <span style="color: var(--muted); font-size: 0.9rem;">({{ entity.end_line - entity.start_line + 1 }}
                    lines)</span>
                {% endif %}
            </div>
            <div>
                <strong>Rank:</strong> {{ entity.rank|round(3) }}<br>
                {% if entity.parent %}
                <strong>Parent:</strong> {{ entity.parent }}<br>
                {% endif %}
                <strong>Stable ID:</strong> <code>{{ entity.stable_id }}</code>
            </div>
        </div>

        {% if entity.doc %}
        <div style="margin-bottom: 1rem;">
            <strong>Documentation:</strong><br>
            <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-top: 0.5rem;">
                {{ entity.doc }}
            </div>
        </div>
        {% endif %}

        {% if entity.signature %}
        <div style="margin-bottom: 1rem;">
            <strong>Signature:</strong><br>
            <div class="code">{{ entity.signature }}</div>
        </div>
        {% endif %}

        {% if entity.calls %}
        <div style="margin-bottom: 1rem;">
            <strong>📞 Functions Called:</strong><br>
            <div class="call-graph">
                {% for call in entity.calls %}
                <span class="call-item">{{ call }}</span>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if entity.imports %}
        <div style="margin-bottom: 1rem;">
            <strong>Imports:</strong><br>
            <div class="import-list">
                {% for import in entity.imports %}
                <div class="import-item">
                    📦 {{ import.path }} (line {{ import.line }})
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% if entity.unresolved_imports %}
        <div style="margin-bottom: 1rem;">
            <strong>Unresolved Imports:</strong><br>
            <div class="import-list">
                {% for import in entity.unresolved_imports %}
                <div class="import-item" style="background: #fff3cd; border-left: 4px solid #ffc107;">
                    ⚠️ {{ import.module }} (line {{ import.line }})
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}